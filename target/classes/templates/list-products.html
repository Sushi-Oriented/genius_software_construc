<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>All Products</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>

<body onload="loadTableData();">
<div class="card" style="padding-top: 30px;">
    <div class="card-body">
        <!-- <div th:switch="${products}" class="container my-5"> -->
        <h1>Product List</h1><br>
        <p>
            <a href="/add-product" class="btn btn-primary">
                Create New Product
            </a>
        </p><br>
        <div class="col-md-15">
            <div>
                <table class="table table-striped table-responsive-md">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Code</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Brand</th>
                        <th>Type</th>
                        <th>Description</th>
                        <th colspan="2">Actions</th>
                    </tr>
                    </thead>
                    <tbody id="prodTable">
                    </tbody>
                </table>
            </div>
        </div>
        <!-- </div> -->
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">

    // Initialize page by load all producst data
    function loadTableData() {
        $(document).ready(function () {
            $.ajax({
                url: 'http://localhost:8080/products',
                type: 'GET',
                contentType: "application/json",
                jsonpCallback: "jsonRead",
                headers: {'Accept': 'application/json', 'X-Request': 'JSON'},
                success: function (response) {
                    console.log(response);
                    if (response == '') {
                        alert('No product exist!');
                    } else {
                        $.each(response, function (i, item) {
                            var $tr = $('<tr>').append(
                                $('<td>').text(item.id),
                                $('<td>').text(item.code),
                                $('<td>').text(item.name),
                                $('<td>').text(item.category),
                                $('<td>').text(item.type),
                                $('<td>').text(item.description),
                                $('<td>').prepend('<button class="btn btn-warning" onclick=getProd(' + item.id + ')><i class="bi bi-pencil-square"></i></button>'),
                                $('<td>').prepend('<button class="btn btn-danger" onclick=deleteProd(' + item.id + ')><i class="bi bi-trash-fill"></i></button>'),
                            ).appendTo('#prodTable');
                            // console.log($tr.wrap('<p>').html());
                        });
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });
    }

    // Delete product
    function deleteProd(prodId) {
        $.ajax({
            url: 'http://localhost:8080/product/' + prodId,
            type: 'delete',
            contentType: 'application/json',
            traditional: true,
            // headers: {'Accept': 'application/json', 'X-Request': 'JSON'},
            success: function (response) {
                alert("Product deleted");
                window.location.reload();
            },
            error: function (error) {
                console.log(error);
            }
        });
    }

    // Redirect to manage product page
    function getProd(prodId) {
        console.log(prodId);
        const url = "http://localhost:8080/edit-product?id=" + prodId;
        console.log(url);
        window.location.href = url;
        // window.open(url, '_blank');
    }

</script>
</body>


</html>